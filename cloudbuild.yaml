steps:
- name: 'gcr.io/cloud-builders/docker'
  dir: 'app'
  args: ['build', '-t', 'asia-east1-docker.pkg.dev/terraform-429505/my-registry/hello-js', '.']
- name: 'gcr.io/cloud-builders/docker'
  dir: 'app'
  args: ['push', 'asia-east1-docker.pkg.dev/terraform-429505/my-registry/hello-js']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  dir: 'clouddeploy-config'
  args:
  - bash
  - -c
  - |
    gcloud deploy targets create test-cloudrun --region=your-region --config=test-target.yaml
    gcloud deploy targets create staging-cloudrun --region=your-region --config=staging-target.yaml
    gcloud deploy targets create prod-cloudrun --region=your-region --config=prod-target.yaml
    gcloud deploy delivery-pipelines create hello-js --region=your-region --config=pipeline.yaml
- name: 'gcr.io/cloud-builders/skaffold'
  dir: 'deploy'
  args: ['deploy', '-p', 'test']
  env:
  - 'GOOGLE_CLOUD_PROJECT=terraform-429505'
- name: 'gcr.io/cloud-builders/skaffold'
  dir: 'deploy'
  args: ['deploy', '-p', 'staging']
  env:
  - 'GOOGLE_CLOUD_PROJECT=terraform-429505'
- name: 'gcr.io/cloud-builders/skaffold'
  dir: 'deploy'
  args: ['deploy', '-p', 'prod']
  env:
  - 'GOOGLE_CLOUD_PROJECT=terraform-429505'
options:
  defaultLogsBucketBehavior: REGIONAL_USER_OWNED_BUCKET
